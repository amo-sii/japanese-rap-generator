<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ—¥æœ¬èªãƒ©ãƒƒãƒ—ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    :root {
      --bg: #0d0d0d;
      --surface: #1a1a2e;
      --surface2: #16213e;
      --accent: #e94560;
      --accent2: #0f3460;
      --purple: #a855f7;
      --cyan: #06b6d4;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --border: #334155;
      --success: #22c55e;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
      min-height: 100vh;
      padding: 24px 16px;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 32px;
    }

    header h1 {
      font-size: 2rem;
      font-weight: 900;
      letter-spacing: 0.05em;
      background: linear-gradient(135deg, var(--accent), var(--purple), var(--cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 6px;
    }

    header p {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .card h2 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    label {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="password"],
    textarea,
    select {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 0.95rem;
      padding: 10px 14px;
      outline: none;
      transition: border-color 0.2s;
      font-family: inherit;
    }

    input[type="text"]:focus,
    input[type="password"]:focus,
    textarea:focus,
    select:focus {
      border-color: var(--purple);
    }

    textarea {
      min-height: 200px;
      resize: vertical;
      line-height: 1.7;
    }

    .api-key-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .api-key-row input {
      flex: 1;
    }

    .btn-icon {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--muted);
      cursor: pointer;
      font-size: 1.1rem;
      padding: 9px 12px;
      transition: color 0.2s;
    }
    .btn-icon:hover { color: var(--text); }

    .style-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .style-chip {
      background: var(--surface2);
      border: 2px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      padding: 12px 14px;
      text-align: center;
      transition: all 0.2s;
      user-select: none;
    }

    .style-chip:hover {
      border-color: var(--purple);
    }

    .style-chip.selected {
      border-color: var(--purple);
      background: rgba(168, 85, 247, 0.15);
    }

    .style-chip .emoji { font-size: 1.4rem; display: block; margin-bottom: 4px; }
    .style-chip .name { font-size: 0.85rem; font-weight: 700; }
    .style-chip .desc { font-size: 0.72rem; color: var(--muted); margin-top: 2px; }

    .generate-btn {
      width: 100%;
      background: linear-gradient(135deg, var(--accent), var(--purple));
      border: none;
      border-radius: 12px;
      color: #fff;
      cursor: pointer;
      font-size: 1.05rem;
      font-weight: 800;
      letter-spacing: 0.05em;
      padding: 16px;
      transition: opacity 0.2s, transform 0.1s;
      font-family: inherit;
    }

    .generate-btn:hover:not(:disabled) {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .generate-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .status-area {
      display: none;
      margin-top: 20px;
    }

    .status-area.visible { display: block; }

    .progress-bar-wrap {
      background: var(--surface2);
      border-radius: 100px;
      height: 6px;
      margin: 12px 0;
      overflow: hidden;
    }

    .progress-bar {
      background: linear-gradient(90deg, var(--accent), var(--purple), var(--cyan));
      background-size: 200% 100%;
      animation: progress-slide 1.5s linear infinite;
      height: 100%;
      width: 100%;
    }

    @keyframes progress-slide {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .status-msg {
      color: var(--muted);
      font-size: 0.88rem;
      text-align: center;
    }

    .results {
      display: none;
      margin-top: 20px;
    }

    .results.visible { display: block; }

    .track-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 14px;
    }

    .track-card h3 {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 10px;
    }

    audio {
      width: 100%;
      accent-color: var(--purple);
    }

    .track-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .btn-download {
      background: rgba(34, 197, 94, 0.15);
      border: 1px solid var(--success);
      border-radius: 8px;
      color: var(--success);
      cursor: pointer;
      font-size: 0.82rem;
      font-weight: 700;
      padding: 6px 14px;
      text-decoration: none;
      transition: background 0.2s;
    }

    .btn-download:hover { background: rgba(34, 197, 94, 0.25); }

    .btn-suno {
      background: rgba(168, 85, 247, 0.15);
      border: 1px solid var(--purple);
      border-radius: 8px;
      color: var(--purple);
      cursor: pointer;
      font-size: 0.82rem;
      font-weight: 700;
      padding: 6px 14px;
      text-decoration: none;
      transition: background 0.2s;
    }

    .btn-suno:hover { background: rgba(168, 85, 247, 0.25); }

    .btn-mv {
      background: rgba(6, 182, 212, 0.15);
      border: 1px solid var(--cyan);
      border-radius: 8px;
      color: var(--cyan);
      cursor: pointer;
      font-size: 0.82rem;
      font-weight: 700;
      padding: 6px 14px;
      font-family: inherit;
      transition: background 0.2s;
    }

    .btn-mv:hover:not(:disabled) { background: rgba(6, 182, 212, 0.25); }
    .btn-mv:disabled { opacity: 0.5; cursor: not-allowed; }

    .mv-area { margin-top: 12px; }

    .mv-area video {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .mv-status {
      color: var(--muted);
      font-size: 0.82rem;
      margin-top: 6px;
    }

    .error-box {
      background: rgba(233, 69, 96, 0.1);
      border: 1px solid var(--accent);
      border-radius: 10px;
      color: #fb7185;
      font-size: 0.88rem;
      margin-top: 16px;
      padding: 12px 16px;
      display: none;
    }

    .error-box.visible { display: block; }

    .tips {
      color: var(--muted);
      font-size: 0.8rem;
      line-height: 1.6;
      margin-top: 8px;
    }

    .tips li { margin-left: 16px; margin-bottom: 2px; }

    @media (max-width: 480px) {
      .style-grid { grid-template-columns: 1fr 1fr; }
      header h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¤ æ—¥æœ¬èªãƒ©ãƒƒãƒ—ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
      <p>æ­Œè©ã‚’å…¥åŠ›ã—ã¦ã€AIãŒæ—¥æœ¬èªãƒ©ãƒƒãƒ—æ›²ã‚’ç”Ÿæˆã—ã¾ã™</p>
    </header>

    <!-- APIã‚­ãƒ¼ -->
    <div class="card">
      <h2>ğŸ”‘ Suno APIã‚­ãƒ¼</h2>
      <div class="api-key-row">
        <input type="password" id="apiKey" placeholder="Suno APIã‚­ãƒ¼ã‚’å…¥åŠ›..." />
        <button class="btn-icon" id="toggleKey" title="è¡¨ç¤º/éè¡¨ç¤º">ğŸ‘ï¸</button>
      </div>
    </div>

    <!-- æ­Œè©å…¥åŠ› -->
    <div class="card">
      <h2>âœï¸ æ­Œè©</h2>
      <label for="title">æ›²ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰</label>
      <input type="text" id="title" placeholder="ä¾‹: å¤œã®æ¸‹è°·" style="margin-bottom:14px" />

      <label for="lyrics">æ­Œè©ã‚’å…¥åŠ›</label>
      <textarea id="lyrics" placeholder="[Verse]
å¤œã®éƒ½ä¼š å…‰ã‚‹è¡—
ä¿ºã®ãƒªãƒªãƒƒã‚¯ éŸ¿ãå£°
å¤¢ã‚’è¿½ã„ã‹ã‘ ã“ã“ã¾ã§æ¥ãŸ
èª°ã‚‚æ­¢ã‚ã‚‰ã‚Œãªã„ ã“ã®æµã‚Œ

[Hook]
ãƒ©ã‚¤ãƒ åˆ»ã‚€ æ­¢ã¾ã‚‰ãªã„
ãƒ“ãƒ¼ãƒˆã«ä¹—ã›ã¦ ç©ºã¸é£›ã¹"></textarea>

      <ul class="tips" style="margin-top:10px">
        <li>[Verse]ã€[Hook]ã€[Chorus]ã€[Bridge] ãªã©ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¨˜æ³•ãŒä½¿ãˆã¾ã™</li>
        <li>è‹±èªã¨æ—¥æœ¬èªã‚’æ··ãœã¦ã‚‚OK</li>
      </ul>
    </div>

    <!-- ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠ -->
    <div class="card">
      <h2>ğŸµ ãƒ©ãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«</h2>
      <div class="style-grid" id="styleGrid">
        <div class="style-chip selected" data-style="Japanese hip-hop, J-rap, boom bap">
          <span class="emoji">ğŸ™ï¸</span>
          <div class="name">J-ãƒ©ãƒƒãƒ—</div>
          <div class="desc">ç‹é“ã®æ—¥æœ¬èªãƒ©ãƒƒãƒ—</div>
        </div>
        <div class="style-chip" data-style="Japanese trap, trap beats, dark hip-hop, 808">
          <span class="emoji">âš¡</span>
          <div class="name">ãƒˆãƒ©ãƒƒãƒ—</div>
          <div class="desc">é‡ä½éŸ³ãƒ»ãƒ€ãƒ¼ã‚¯ãªãƒ“ãƒ¼ãƒˆ</div>
        </div>
        <div class="style-chip" data-style="Japanese drill, melodic drill, UK drill influenced">
          <span class="emoji">ğŸ”«</span>
          <div class="name">ãƒ‰ãƒªãƒ«</div>
          <div class="desc">æ”»æ’ƒçš„ãƒ»éƒ½ä¼šçš„ã‚µã‚¦ãƒ³ãƒ‰</div>
        </div>
        <div class="style-chip" data-style="Japanese lo-fi hip-hop, chill rap, mellow beats">
          <span class="emoji">ğŸŒ™</span>
          <div class="name">ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤</div>
          <div class="desc">ãƒãƒ«ã§ã¾ã£ãŸã‚Šã—ãŸé›°å›²æ°—</div>
        </div>
        <div class="style-chip" data-style="Japanese old school hip-hop, boom bap, 90s rap">
          <span class="emoji">ğŸ“¼</span>
          <div class="name">ã‚ªãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¯ãƒ¼ãƒ«</div>
          <div class="desc">90å¹´ä»£ã‚¹ã‚¿ã‚¤ãƒ«</div>
        </div>
        <div class="style-chip" data-style="Japanese pop rap, melodic rap, catchy hooks, upbeat">
          <span class="emoji">ğŸŒ¸</span>
          <div class="name">ãƒãƒƒãƒ—ãƒ©ãƒƒãƒ—</div>
          <div class="desc">ã‚­ãƒ£ãƒƒãƒãƒ¼ã§ãƒãƒƒãƒ—ãªæ›²</div>
        </div>
      </div>
    </div>

    <!-- ç”Ÿæˆãƒœã‚¿ãƒ³ -->
    <button class="generate-btn" id="generateBtn">ğŸ¤ ãƒ©ãƒƒãƒ—ã‚’ç”Ÿæˆã™ã‚‹</button>

    <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
    <div class="error-box" id="errorBox"></div>

    <!-- ç”Ÿæˆä¸­ -->
    <div class="status-area" id="statusArea">
      <div class="card">
        <div class="progress-bar-wrap">
          <div class="progress-bar"></div>
        </div>
        <p class="status-msg" id="statusMsg">Sunoã§ç”Ÿæˆä¸­... ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ï¼ˆç´„30ã€œ60ç§’ï¼‰</p>
      </div>
    </div>

    <!-- çµæœ -->
    <div class="results" id="results">
      <div class="card">
        <h2>ğŸ§ ç”Ÿæˆã•ã‚ŒãŸæ¥½æ›²</h2>
        <div id="trackList"></div>
      </div>
    </div>
  </div>

  <script>
    // ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠ
    const chips = document.querySelectorAll('.style-chip');
    let selectedStyle = chips[0].dataset.style;

    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        chips.forEach(c => c.classList.remove('selected'));
        chip.classList.add('selected');
        selectedStyle = chip.dataset.style;
      });
    });

    // APIã‚­ãƒ¼è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆï¼†localStorageä¿å­˜
    const keyInput = document.getElementById('apiKey');

    // ä¿å­˜æ¸ˆã¿ã®ã‚­ãƒ¼ã‚’è‡ªå‹•å…¥åŠ›
    const savedKey = localStorage.getItem('suno_api_key');
    if (savedKey) keyInput.value = savedKey;

    document.getElementById('toggleKey').addEventListener('click', () => {
      keyInput.type = keyInput.type === 'password' ? 'text' : 'password';
    });

    // å…¥åŠ›ã™ã‚‹ãŸã³ã«ä¿å­˜
    keyInput.addEventListener('input', () => {
      localStorage.setItem('suno_api_key', keyInput.value.trim());
    });

    // ç”Ÿæˆå‡¦ç†
    const generateBtn = document.getElementById('generateBtn');
    const statusArea = document.getElementById('statusArea');
    const statusMsg = document.getElementById('statusMsg');
    const resultsDiv = document.getElementById('results');
    const trackList = document.getElementById('trackList');
    const errorBox = document.getElementById('errorBox');

    function showError(msg) {
      errorBox.textContent = msg;
      errorBox.classList.add('visible');
    }

    function hideError() {
      errorBox.classList.remove('visible');
    }

    generateBtn.addEventListener('click', async () => {
      const lyrics = document.getElementById('lyrics').value.trim();
      const title = document.getElementById('title').value.trim();
      const apiKey = keyInput.value.trim();

      hideError();
      resultsDiv.classList.remove('visible');
      trackList.innerHTML = '';

      if (!lyrics) { showError('æ­Œè©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
      if (!apiKey) { showError('Suno APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

      generateBtn.disabled = true;
      statusArea.classList.add('visible');
      statusMsg.textContent = 'Sunoã«ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ä¸­...';

      try {
        // ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
        const genRes = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ lyrics, title, style: selectedStyle, api_key: apiKey }),
        });
        const genData = await genRes.json();

        if (!genRes.ok) {
          throw new Error(genData.error || 'ç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }

        const taskId = genData.task_id;
        statusMsg.textContent = `ç”Ÿæˆä¸­... (ã‚¿ã‚¹ã‚¯ID: ${taskId})`;

        // ãƒãƒ¼ãƒªãƒ³ã‚°ã§å®Œäº†ã‚’å¾…ã¤
        const tracks = await pollForCompletion(taskId, apiKey);
        renderTracks(tracks);

      } catch (err) {
        showError(err.message);
      } finally {
        generateBtn.disabled = false;
        statusArea.classList.remove('visible');
      }
    });

    // sunoapi.org ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: PENDING â†’ TEXT_SUCCESS â†’ FIRST_SUCCESS â†’ SUCCESS
    async function pollForCompletion(taskId, apiKey, maxWait = 180000) {
      const interval = 5000;
      const deadline = Date.now() + maxWait;

      while (Date.now() < deadline) {
        await new Promise(r => setTimeout(r, interval));

        const res = await fetch(`/api/status?task_id=${encodeURIComponent(taskId)}&api_key=${encodeURIComponent(apiKey)}`);
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');

        const status = data.status;

        if (status === 'SUCCESS') {
          return data.response.sunoData;
        }

        const statusLabels = {
          PENDING: 'å¾…æ©Ÿä¸­...',
          TEXT_SUCCESS: 'æ­Œè©å‡¦ç†å®Œäº†ã€éŸ³æ¥½ç”Ÿæˆä¸­...',
          FIRST_SUCCESS: 'ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æº–å‚™å®Œäº†ã€ä»•ä¸Šã’ä¸­...',
        };
        statusMsg.textContent = statusLabels[status] || `ç”Ÿæˆä¸­... (${status})`;
      }

      throw new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: ç”Ÿæˆã«æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã¦ã„ã¾ã™ã€‚ã—ã°ã‚‰ãå¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
    }

    function renderTracks(sunoData) {
      trackList.innerHTML = '';
      sunoData.forEach((track, i) => {
        const audioUrl = track.audioUrl || track.streamAudioUrl || '';
        const sunoUrl = track.id ? `https://suno.com/song/${track.id}` : '#';
        const coverUrl = track.imageUrl || '';
        const musicId = track.id || '';

        const div = document.createElement('div');
        div.className = 'track-card';
        div.innerHTML = `
          <h3>ãƒˆãƒ©ãƒƒã‚¯ ${i + 1}${track.title ? ' â€” ' + track.title : ''}</h3>
          ${coverUrl ? `<img src="${coverUrl}" alt="cover" style="width:100%;border-radius:8px;margin-bottom:10px;max-height:200px;object-fit:cover;">` : ''}
          ${audioUrl
            ? `<audio controls src="${audioUrl}"></audio>`
            : `<p style="color:var(--muted);font-size:0.85rem">éŸ³å£°URLã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚Sunoã®ã‚µã‚¤ãƒˆã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>`
          }
          <div class="track-actions">
            ${audioUrl ? `<a class="btn-download" href="${audioUrl}" download="rap_track_${i+1}.mp3">â¬‡ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>` : ''}
            <a class="btn-suno" href="${sunoUrl}" target="_blank" rel="noopener">ğŸ”— Sunoã§é–‹ã</a>
            ${musicId ? `<button class="btn-mv" data-music-id="${musicId}" data-index="${i}">ğŸ¬ MVã‚’ç”Ÿæˆ</button>` : ''}
          </div>
          <div class="mv-area" id="mv-area-${i}"></div>
        `;
        trackList.appendChild(div);
      });

      // MVãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
      document.querySelectorAll('.btn-mv').forEach(btn => {
        btn.addEventListener('click', async () => {
          const musicId = btn.dataset.musicId;
          const idx = btn.dataset.index;
          const mvArea = document.getElementById(`mv-area-${idx}`);
          const apiKey = keyInput.value.trim();

          btn.disabled = true;
          btn.textContent = 'ğŸ¬ MVç”Ÿæˆä¸­...';
          mvArea.innerHTML = '<p class="mv-status">MVã‚’ç”Ÿæˆä¸­... ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ï¼ˆç´„2ã€œ3åˆ†ï¼‰</p>';

          try {
            // MVç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            const genRes = await fetch('/api/generate-mv', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ music_id: musicId, music_index: parseInt(idx), api_key: apiKey }),
            });
            const genData = await genRes.json();
            if (!genRes.ok) throw new Error(genData.error || 'MVç”Ÿæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');

            // ãƒãƒ¼ãƒªãƒ³ã‚°ã§å®Œäº†ã‚’å¾…ã¤
            const videoUrl = await pollMvCompletion(genData.task_id, apiKey, mvArea);

            mvArea.innerHTML = `
              <video controls src="${videoUrl}"></video>
              <div class="track-actions">
                <a class="btn-download" href="${videoUrl}" download="rap_mv_${idx}.mp4">â¬‡ï¸ MVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
              </div>
            `;
            btn.textContent = 'ğŸ¬ MVç”Ÿæˆæ¸ˆã¿';
          } catch (err) {
            mvArea.innerHTML = `<p class="mv-status" style="color:#fb7185">${err.message}</p>`;
            btn.disabled = false;
            btn.textContent = 'ğŸ¬ MVã‚’ç”Ÿæˆ';
          }
        });
      });

      resultsDiv.classList.add('visible');
    }

    async function pollMvCompletion(taskId, apiKey, mvArea, maxWait = 300000) {
      const interval = 6000;
      const deadline = Date.now() + maxWait;

      while (Date.now() < deadline) {
        await new Promise(r => setTimeout(r, interval));

        const res = await fetch(`/api/mv-status?task_id=${encodeURIComponent(taskId)}&api_key=${encodeURIComponent(apiKey)}`);
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'MVã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');

        if (data.successFlag === 'SUCCESS') {
          return data.response.videoUrl;
        }

        mvArea.innerHTML = `<p class="mv-status">MVç”Ÿæˆä¸­... (${data.successFlag || 'å‡¦ç†ä¸­'})</p>`;
      }

      throw new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: MVç”Ÿæˆã«æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã¦ã„ã¾ã™ã€‚');
    }
  </script>
</body>
</html>
